name: automatisation

on:
  push:
    branches-ignore:
    - ga-ignore-
  pull_request:
    branches-ignore:
    - ga-ignore-
env:
      MIRROR_URL: https://github.com/EpitechPromo2026/B-DOP-200-COT-2-1-chocolatine-alberick.mahoussi.git
      EXECUTABLES: lib/my/libmy.a
  
jobs:
    check_reposistory_cleanliness:
      name: check_cleanliness
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v3
        - id: check_reposistory_cleanliness
          run: |
            r_file=($(find . -path '*/tmp/*' -name "*#" -o -name "#*" -o -iname "*pain_au_chocolat*" -o -name "*.o" -o -name "*.a" -o -name "*~" -o -name "~*" -o -name "*.so" -o -name "*.gcno" -o -name "*.gcda" -o -name "*.gcov" ))
            for a in ${r_file[@]}; do
            echo "::error file=$a,line=1,endLine=1,title=Unwanted file detected::$a"; done
            if [[ -n $r_file ]]
            then
              exit 1
            else
            echo No unwnanted file detected
            fi
            
    verification_of_compilation:
      needs: [check_reposistory_cleanliness]
      name: check if file can compile
      runs-on:  ubuntu-latest
      container:
        image: epitechcontent/epitest-docker:latest
      steps:
        - uses: actions/checkout@v3
        - id: check_program_compilation
          run: make
          timeout-minutes: 2
        - run: make clean
        
    test_file_working:
      needs: [verification_of_compilation]
      name: test run
      runs-on: ubuntu-latest
      container:
        image: epitechcontent/epitest-docker:latest
      steps:
        - uses: action/checkout@v3
        - id: run_test
          run: make test_run
          timeout-minutes: 2
          
      
        
        
  
